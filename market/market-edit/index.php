<?
require($_SERVER["DOCUMENT_ROOT"]."/bitrix/header.php");
$APPLICATION->SetTitle("Изменить маркетплейс");
?>
<?
use \Bitrix\Main\Page\Asset;
Asset::getInstance()->addJs('/assets/js/market-edit.js');
?>
<?
CModule::IncludeModule('iblock');
global $USER;
if($_GET['id']>0){
    $arSelect = Array("ID", "NAME", "PROPERTY_SITE", "PROPERTY_URL", "PROPERTY_LOGO", "PROPERTY_ACT");
    $arFilter = Array("IBLOCK_ID"=>3, "ID"=>$_GET['id'], "ACTIVE"=>"Y");
    $res = CIBlockElement::GetList(Array(), $arFilter, false, false, $arSelect);
    if($ob = $res->GetNextElement())
    {
        $arFields = $ob->GetFields();
        $arSelectSite = Array("ID", "NAME", "PROPERTY_USER");
        $arFilterSite = Array("IBLOCK_ID"=>4, "ID"=>$arFields['PROPERTY_SITE_VALUE'], "ACTIVE"=>"Y");
        $resSite = CIBlockElement::GetList(Array(), $arFilterSite, false, false, $arSelectSite);
        if($obSite = $resSite->GetNextElement())
        {
            $arFieldsSite = $obSite->GetFields();
            ?>
            <?if($arFieldsSite['PROPERTY_USER_VALUE']==$USER->GetID()):?>
                <form class="addsite" method="POST" id="market-edit" enctype="multipart/form-data">
                    <input type="hidden" name="market-id" value="<?=$_GET['id']?>">
                    <input type="hidden" name="market-act" value="<?=$arFields['PROPERTY_ACT_VALUE']?>">
                	<input type="hidden" name="site-id" value="<?=currentSiteID($USER->GetID());?>">
                    <input type="hidden" name="market-name" id="market-name" value="<?=$arFields['NAME']?>">
                    <div class="addsite__title">
                        <span contenteditable="true" id="market-name-span"><?=$arFields['NAME']?></span>
                        <svg width="21" height="21" viewBox="0 0 21 21" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M19 10.9999C18.7348 10.9999 18.4804 11.1053 18.2929 11.2928C18.1054 11.4804 18 11.7347 18 11.9999V17.9999C18 18.2652 17.8946 18.5195 17.7071 18.707C17.5196 18.8946 17.2652 18.9999 17 18.9999H3C2.73478 18.9999 2.48043 18.8946 2.29289 18.707C2.10536 18.5195 2 18.2652 2 17.9999V3.99994C2 3.73472 2.10536 3.48037 2.29289 3.29283C2.48043 3.1053 2.73478 2.99994 3 2.99994H9C9.26522 2.99994 9.51957 2.89458 9.70711 2.70705C9.89464 2.51951 10 2.26516 10 1.99994C10 1.73472 9.89464 1.48037 9.70711 1.29283C9.51957 1.1053 9.26522 0.999939 9 0.999939H3C2.20435 0.999939 1.44129 1.31601 0.87868 1.87862C0.316071 2.44123 0 3.20429 0 3.99994V17.9999C0 18.7956 0.316071 19.5587 0.87868 20.1213C1.44129 20.6839 2.20435 20.9999 3 20.9999H17C17.7956 20.9999 18.5587 20.6839 19.1213 20.1213C19.6839 19.5587 20 18.7956 20 17.9999V11.9999C20 11.7347 19.8946 11.4804 19.7071 11.2928C19.5196 11.1053 19.2652 10.9999 19 10.9999ZM4 11.7599V15.9999C4 16.2652 4.10536 16.5195 4.29289 16.707C4.48043 16.8946 4.73478 16.9999 5 16.9999H9.24C9.37161 17.0007 9.50207 16.9755 9.62391 16.9257C9.74574 16.8759 9.85656 16.8026 9.95 16.7099L16.87 9.77994L19.71 6.99994C19.8037 6.90698 19.8781 6.79637 19.9289 6.67452C19.9797 6.55266 20.0058 6.42195 20.0058 6.28994C20.0058 6.15793 19.9797 6.02722 19.9289 5.90536C19.8781 5.7835 19.8037 5.6729 19.71 5.57994L15.47 1.28994C15.377 1.19621 15.2664 1.12182 15.1446 1.07105C15.0227 1.02028 14.892 0.994141 14.76 0.994141C14.628 0.994141 14.4973 1.02028 14.3754 1.07105C14.2536 1.12182 14.143 1.19621 14.05 1.28994L11.23 4.11994L4.29 11.0499C4.19732 11.1434 4.12399 11.2542 4.07423 11.376C4.02446 11.4979 3.99924 11.6283 4 11.7599ZM14.76 3.40994L17.59 6.23994L16.17 7.65994L13.34 4.82994L14.76 3.40994ZM6 12.1699L11.93 6.23994L14.76 9.06994L8.83 14.9999H6V12.1699Z" fill="#EEA941"></path>
                        </svg>
                    </div>
                    <label>
                        Логотип маркетплейса
                    </label>
                    <div class="logo-down">
                        <?if($arFields['PROPERTY_LOGO_VALUE']):?>
                            <img src="<?=CFile::GetPath($arFields['PROPERTY_LOGO_VALUE']);?>">
                        <?else:?>
                            <img src="/assets/img/market/file.jpg">
                        <?endif;?>
                        <div class="file">
                            <input type="file" id="file" name="market-logo">
                            <label for="file" class="btn-fiolet">
                                <svg width="22" height="21" viewBox="0 0 22 21" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M20.71 5.29C20.617 5.19627 20.5064 5.12188 20.3846 5.07111C20.2627 5.02034 20.132 4.9942 20 4.9942C19.868 4.9942 19.7373 5.02034 19.6154 5.07111C19.4936 5.12188 19.383 5.19627 19.29 5.29L18 6.59V1C18 0.734784 17.8946 0.48043 17.7071 0.292893C17.5196 0.105357 17.2652 0 17 0C16.7348 0 16.4804 0.105357 16.2929 0.292893C16.1054 0.48043 16 0.734784 16 1V6.59L14.71 5.29C14.5217 5.1017 14.2663 4.99591 14 4.99591C13.7337 4.99591 13.4783 5.1017 13.29 5.29C13.1017 5.4783 12.9959 5.7337 12.9959 6C12.9959 6.2663 13.1017 6.5217 13.29 6.71L16.29 9.71C16.3851 9.80104 16.4972 9.87241 16.62 9.92C16.7397 9.97291 16.8691 10.0002 17 10.0002C17.1309 10.0002 17.2603 9.97291 17.38 9.92C17.5028 9.87241 17.6149 9.80104 17.71 9.71L20.71 6.71C20.8037 6.61704 20.8781 6.50644 20.9289 6.38458C20.9797 6.26272 21.0058 6.13201 21.0058 6C21.0058 5.86799 20.9797 5.73728 20.9289 5.61542C20.8781 5.49356 20.8037 5.38296 20.71 5.29ZM17 12C16.7348 12 16.4804 12.1054 16.2929 12.2929C16.1054 12.4804 16 12.7348 16 13V13.38L14.52 11.9C13.9974 11.3815 13.2911 11.0906 12.555 11.0906C11.8189 11.0906 11.1126 11.3815 10.59 11.9L9.89 12.6L7.41 10.12C6.88012 9.6156 6.17657 9.33429 5.445 9.33429C4.71343 9.33429 4.00988 9.6156 3.48 10.12L2 11.6V6C2 5.73478 2.10536 5.48043 2.29289 5.29289C2.48043 5.10536 2.73478 5 3 5H11C11.2652 5 11.5196 4.89464 11.7071 4.70711C11.8946 4.51957 12 4.26522 12 4C12 3.73478 11.8946 3.48043 11.7071 3.29289C11.5196 3.10536 11.2652 3 11 3H3C2.20435 3 1.44129 3.31607 0.87868 3.87868C0.316071 4.44129 0 5.20435 0 6V18C0 18.7956 0.316071 19.5587 0.87868 20.1213C1.44129 20.6839 2.20435 21 3 21H15C15.7956 21 16.5587 20.6839 17.1213 20.1213C17.6839 19.5587 18 18.7956 18 18V13C18 12.7348 17.8946 12.4804 17.7071 12.2929C17.5196 12.1054 17.2652 12 17 12ZM3 19C2.73478 19 2.48043 18.8946 2.29289 18.7071C2.10536 18.5196 2 18.2652 2 18V14.43L4.9 11.53C5.04691 11.39 5.24206 11.3119 5.445 11.3119C5.64794 11.3119 5.84309 11.39 5.99 11.53L9.16 14.7L13.46 19H3ZM16 18C15.9986 18.1914 15.9354 18.3773 15.82 18.53L11.31 14L12.01 13.3C12.0817 13.2268 12.1673 13.1687 12.2617 13.129C12.3561 13.0893 12.4576 13.0689 12.56 13.0689C12.6624 13.0689 12.7639 13.0893 12.8583 13.129C12.9527 13.1687 13.0383 13.2268 13.11 13.3L16 16.21V18Z" fill="white"/>
                                    </svg>
                                    
                                Выбрать файл</label>
                        </div>
                    </div>
                    <label>
                        Ссылка на маркетплейс
                    </label>
                    <div class="site-input">
                        <input type="text" name="market-url" value="<?=$arFields['PROPERTY_URL_VALUE']?>">
                    </div>
                    <button class="addsite__save btn-red">Сохранить изменения</button>
                    <div id="market-mess"></div>
                </form>
            <?else:?>
                Ошибка доступа.
            <?endif;?>
        <?}
    }
}

?>
<?require($_SERVER["DOCUMENT_ROOT"]."/bitrix/footer.php");?>